<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Player Management Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .controls { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .test-grid { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 15px; 
            min-height: 400px;
            background: white;
            padding: 20px;
            border-radius: 8px;
        }
        .player-column { 
            border: 2px solid #ccc; 
            padding: 15px; 
            text-align: center; 
            border-radius: 8px;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .base-player { border-color: #2196F3; background: #E3F2FD; }
        .extra-player { border-color: orange; }
        .center-column { border-color: #4CAF50; background: #E8F5E8; }
        button { padding: 10px 15px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
        .remove-btn { background: #ff4444; color: white; }
        .add-btn { background: #44aa44; color: white; }
        .remove-btn:disabled, .add-btn:disabled { background: #ccc; cursor: not-allowed; }
        .status { margin: 10px 0; font-weight: bold; }
        .player-info { font-size: 0.9em; color: #666; margin-top: 5px; }
        .demo-buttons { margin-top: 15px; }
        .demo-buttons button { background: #2196F3; color: white; margin: 2px; }
    </style>
</head>
<body>
    <h1>Advanced Player Management Test - Gap Elimination</h1>
    
    <div class="controls">
        <div>
            <button id="add-player" class="add-btn">Add Player</button>
            <button id="remove-player" class="remove-btn">Remove Player</button>
            <span id="player-count" class="status">Players: 2</span>
        </div>
        
        <div class="demo-buttons">
            <strong>Quick Demo:</strong>
            <button onclick="addPlayers([1,3,5,7])">Add P3,P5,P7,P9</button>
            <button onclick="removePlayer('extra3')">Remove P5</button>
            <button onclick="removePlayer('extra1')">Remove P3</button>
            <button onclick="addPlayer(1)">Re-add P3</button>
            <button onclick="resetAll()">Reset All</button>
        </div>
    </div>
    
    <div class="test-grid" id="player-grid">
        <div class="player-column base-player" style="grid-column: 1; grid-row: 1;">
            <h3>Player 1 (Left)</h3>
            <div class="player-info">Base player - Row 1</div>
        </div>
        <div class="player-column center-column" style="grid-column: 2; grid-row: 1;">
            <h3>Unassigned Chores</h3>
            <div class="player-info">Center column - Spans all rows</div>
        </div>
        <div class="player-column base-player" style="grid-column: 3; grid-row: 1;">
            <h3>Player 2 (Right)</h3>
            <div class="player-info">Base player - Row 1</div>
        </div>
    </div>
    
    <div style="margin-top: 20px; background: white; padding: 15px; border-radius: 8px;">
        <h3>How Gap Elimination Works:</h3>
        <ul>
            <li><strong>No Gaps:</strong> When a player is removed, all players below move up to fill the gap</li>
            <li><strong>Balanced Sides:</strong> Left side (odd players) and right side (even players) are managed separately</li>
            <li><strong>Original Positions:</strong> When a removed player is re-added, they return to their original slot</li>
            <li><strong>Dynamic Spanning:</strong> Center column automatically adjusts height based on active players</li>
        </ul>
    </div>
    
    <script>
        // Enhanced test implementation
        let extraPlayers = {};
        const playerColors = {
            extra1: 'orange', extra2: 'limegreen', extra3: 'purple', extra4: 'yellow',
            extra5: 'pink', extra6: 'brown', extra7: 'gray', extra8: 'teal'
        };
        const playerNames = {
            extra1: 'Player 3', extra2: 'Player 4', extra3: 'Player 5', extra4: 'Player 6',
            extra5: 'Player 7', extra6: 'Player 8', extra7: 'Player 9', extra8: 'Player 10'
        };
        
        function getNextAvailableSlot() {
            for(let i = 1; i <= 8; i++) {
                if(!extraPlayers[`extra${i}`]) return i;
            }
            return null;
        }
        
        function getTotalPlayers() {
            return 2 + Object.values(extraPlayers).filter(Boolean).length;
        }
        
        function getActiveExtraPlayers() {
            const activeExtras = [];
            for(let i = 1; i <= 8; i++) {
                const extraKey = `extra${i}`;
                if(extraPlayers[extraKey]) {
                    activeExtras.push({
                        key: extraKey,
                        number: i,
                        isLeft: i % 2 === 1
                    });
                }
            }
            return activeExtras;
        }
        
        function calculateOptimalPositions() {
            const activeExtras = getActiveExtraPlayers();
            const leftPlayers = activeExtras.filter(p => p.isLeft).sort((a, b) => a.number - b.number);
            const rightPlayers = activeExtras.filter(p => !p.isLeft).sort((a, b) => a.number - b.number);
            
            const positions = {};
            
            // Assign left side positions (starting from row 2)
            leftPlayers.forEach((player, index) => {
                positions[player.key] = {
                    column: 1,
                    row: index + 2
                };
            });
            
            // Assign right side positions (starting from row 2)
            rightPlayers.forEach((player, index) => {
                positions[player.key] = {
                    column: 3,
                    row: index + 2
                };
            });
            
            return positions;
        }
        
        function repositionAllColumns() {
            const positions = calculateOptimalPositions();
            
            // Update all existing columns
            Object.keys(positions).forEach(extraKey => {
                const column = document.getElementById(`column-${extraKey}`);
                if(column) {
                    const pos = positions[extraKey];
                    column.style.gridColumn = pos.column.toString();
                    column.style.gridRow = pos.row.toString();
                }
            });
            
            // Update center column span
            updateCenterColumnSpan();
        }
        
        function updateCenterColumnSpan() {
            const centerColumn = document.querySelector('.center-column');
            const activeExtras = getActiveExtraPlayers();
            
            if(activeExtras.length === 0) {
                centerColumn.style.gridRow = '1';
                return;
            }
            
            const leftPlayers = activeExtras.filter(p => p.isLeft);
            const rightPlayers = activeExtras.filter(p => !p.isLeft);
            const maxRowsNeeded = Math.max(leftPlayers.length, rightPlayers.length) + 1;
            
            centerColumn.style.gridRow = `1 / ${maxRowsNeeded + 1}`;
        }
        
        function updateButtons() {
            const totalPlayers = getTotalPlayers();
            const nextSlot = getNextAvailableSlot();
            
            document.getElementById('add-player').disabled = !nextSlot;
            document.getElementById('remove-player').disabled = totalPlayers <= 2;
            document.getElementById('player-count').textContent = `Players: ${totalPlayers}`;
        }
        
        function addPlayer(specificSlot = null) {
            const slot = specificSlot || getNextAvailableSlot();
            if(!slot) return;
            
            const extraKey = `extra${slot}`;
            extraPlayers[extraKey] = true;
            
            const grid = document.getElementById('player-grid');
            const newColumn = document.createElement('div');
            newColumn.className = 'player-column extra-player';
            newColumn.id = `column-${extraKey}`;
            newColumn.style.backgroundColor = playerColors[extraKey];
            newColumn.style.color = playerColors[extraKey] === 'yellow' ? 'black' : 'white';
            
            // Initially position (will be corrected by repositioning)
            const isLeft = slot % 2 === 1;
            newColumn.style.gridColumn = isLeft ? '1' : '3';
            newColumn.style.gridRow = '2';
            
            newColumn.innerHTML = `
                <h3>${playerNames[extraKey]}</h3>
                <div class="player-info">Slot ${slot} - ${isLeft ? 'Left' : 'Right'} Side</div>
            `;
            
            grid.appendChild(newColumn);
            
            // Reposition all columns to eliminate gaps
            repositionAllColumns();
            updateButtons();
        }
        
        function removePlayer(specificPlayer = null) {
            let playerToRemove = specificPlayer;
            
            if(!playerToRemove) {
                const activePlayers = Object.keys(extraPlayers).filter(key => extraPlayers[key]);
                if(activePlayers.length === 0) return;
                
                // Simple selection for demo
                const playerList = activePlayers.map(key => `${key}: ${playerNames[key]}`).join('\n');
                playerToRemove = prompt(`Choose player to remove:\n${playerList}\n\nEnter player key (e.g., extra1):`);
            }
            
            if(playerToRemove && extraPlayers[playerToRemove]) {
                extraPlayers[playerToRemove] = false;
                const column = document.getElementById(`column-${playerToRemove}`);
                if(column) column.remove();
                
                // Reposition remaining columns to eliminate gaps
                repositionAllColumns();
                updateButtons();
            }
        }
        
        function addPlayers(slots) {
            slots.forEach(slot => addPlayer(slot));
        }
        
        function resetAll() {
            Object.keys(extraPlayers).forEach(key => {
                extraPlayers[key] = false;
                const column = document.getElementById(`column-${key}`);
                if(column) column.remove();
            });
            updateCenterColumnSpan();
            updateButtons();
        }
        
        document.getElementById('add-player').addEventListener('click', () => addPlayer());
        document.getElementById('remove-player').addEventListener('click', () => removePlayer());
        
        updateButtons();
    </script>
</body>
</html>