<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Assign Test - All Players</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .controls { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .test-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 15px; 
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .player-section { 
            border: 2px solid #ccc; 
            padding: 15px; 
            border-radius: 8px;
            min-height: 150px;
        }
        .chore-item { 
            background: #f0f0f0; 
            padding: 8px; 
            margin: 5px 0; 
            border-radius: 4px; 
            font-size: 0.9em;
        }
        .player-active { border-color: #4CAF50; background: #E8F5E8; }
        .player-removed { border-color: #ccc; background: #f9f9f9; opacity: 0.5; }
        button { padding: 10px 15px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
        .assign-btn { background: #2196F3; color: white; }
        .clear-btn { background: #ff4444; color: white; }
        .toggle-btn { background: #FF9800; color: white; }
        .status { margin: 10px 0; font-weight: bold; }
        .feature-highlight { background: #fff3cd; border: 1px solid #ffeaa7; padding: 10px; border-radius: 6px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>üé≤ Random Assign Test - All Players</h1>
    
    <div class="feature-highlight">
        <strong>üÜï UPDATED:</strong> Random assign now works with ANY combination of active players (1-10 players) and distributes chores equally!
    </div>
    
    <div class="controls">
        <div>
            <button class="assign-btn" onclick="randomAssignChores()">üé≤ Random Assign Chores</button>
            <button class="clear-btn" onclick="clearAllChores()">üóëÔ∏è Clear All Assignments</button>
            <button onclick="addTestChores()">üìù Add Test Chores</button>
        </div>
        
        <div style="margin-top: 10px;">
            <strong>Player Controls:</strong><br>
            <button class="toggle-btn" onclick="togglePlayer('player1')">Toggle Player 1</button>
            <button class="toggle-btn" onclick="togglePlayer('player2')">Toggle Player 2</button>
            <button class="toggle-btn" onclick="togglePlayer('player3')">Toggle Player 3</button>
            <button class="toggle-btn" onclick="togglePlayer('player4')">Toggle Player 4</button>
            <button class="toggle-btn" onclick="togglePlayer('player5')">Toggle Player 5</button>
        </div>
        
        <div class="status" id="status">Ready to test!</div>
    </div>
    
    <div class="test-grid" id="player-grid">
        <!-- Players will be populated by JavaScript -->
    </div>
    
    <div style="background: white; padding: 15px; border-radius: 8px;">
        <h3>üß™ Test Scenarios:</h3>
        <ul>
            <li><strong>Equal Distribution:</strong> Toggle different players on/off and see how chores distribute equally</li>
            <li><strong>Single Player:</strong> Leave only one player active - all chores should go to them</li>
            <li><strong>Odd Numbers:</strong> With odd number of chores and even number of players, difference should be at most 1</li>
            <li><strong>Smart Balancing:</strong> Players with fewer chores get priority for new assignments</li>
        </ul>
        
        <h3>üìä How It Works:</h3>
        <ul>
            <li>Uses <code>getActivePlayers()</code> to find all currently active players</li>
            <li>Counts existing chores per player to maintain balance</li>
            <li>Shuffles unassigned chores for random distribution</li>
            <li>Always assigns to player(s) with fewest current chores</li>
            <li>Works with any combination of Player 1, Player 2, and Extra Players 3-10</li>
        </ul>
    </div>
    
    <script>
        // Mock player management system for testing
        let activePlayerStates = {
            player1: true, player2: true, player3: false, player4: false, player5: false
        };
        
        let playerChores = {
            player1: [], player2: [], player3: [], player4: [], player5: []
        };
        
        let unassignedChores = [];
        let choreIdCounter = 1;
        
        const playerNames = {
            player1: 'Player 1', player2: 'Player 2', player3: 'Player 3',
            player4: 'Player 4', player5: 'Player 5'
        };
        
        const playerColors = {
            player1: '#2196F3', player2: '#E53E3E', player3: 'orange',
            player4: 'limegreen', player5: 'purple'
        };
        
        function getActivePlayers() {
            return Object.keys(activePlayerStates)
                .filter(key => activePlayerStates[key])
                .map(key => ({ loc: key, name: playerNames[key] }));
        }
        
        function updateDisplay() {
            const grid = document.getElementById('player-grid');
            grid.innerHTML = '';
            
            // Show all players (active and inactive)
            Object.keys(activePlayerStates).forEach(playerId => {
                const isActive = activePlayerStates[playerId];
                const chores = playerChores[playerId] || [];
                
                const playerDiv = document.createElement('div');
                playerDiv.className = `player-section ${isActive ? 'player-active' : 'player-removed'}`;
                playerDiv.style.borderColor = isActive ? playerColors[playerId] : '#ccc';
                
                playerDiv.innerHTML = `
                    <h3 style="color: ${isActive ? playerColors[playerId] : '#999'};">
                        ${playerNames[playerId]} ${isActive ? '‚úÖ' : '‚ùå'}
                    </h3>
                    <div style="font-size: 0.9em; margin-bottom: 10px;">
                        Chores: ${chores.length}
                    </div>
                    <div class="chores-list">
                        ${chores.map(chore => `<div class="chore-item">${chore}</div>`).join('')}
                    </div>
                `;
                
                grid.appendChild(playerDiv);
            });
            
            // Add unassigned chores section
            const unassignedDiv = document.createElement('div');
            unassignedDiv.className = 'player-section';
            unassignedDiv.style.borderColor = '#4CAF50';
            unassignedDiv.style.background = '#E8F5E8';
            
            unassignedDiv.innerHTML = `
                <h3 style="color: #4CAF50;">Unassigned Chores</h3>
                <div style="font-size: 0.9em; margin-bottom: 10px;">
                    Count: ${unassignedChores.length}
                </div>
                <div class="chores-list">
                    ${unassignedChores.map(chore => `<div class="chore-item">${chore}</div>`).join('')}
                </div>
            `;
            
            grid.appendChild(unassignedDiv);
            
            // Update status
            const activePlayers = getActivePlayers();
            document.getElementById('status').textContent = 
                `Active Players: ${activePlayers.length} | Unassigned Chores: ${unassignedChores.length}`;
        }
        
        function togglePlayer(playerId) {
            activePlayerStates[playerId] = !activePlayerStates[playerId];
            
            // If player is being deactivated, move their chores to unassigned
            if (!activePlayerStates[playerId]) {
                unassignedChores.push(...playerChores[playerId]);
                playerChores[playerId] = [];
            }
            
            updateDisplay();
        }
        
        function addTestChores() {
            const newChores = [
                'Wash dishes', 'Take out trash', 'Vacuum living room', 'Clean bathroom',
                'Do laundry', 'Mop kitchen floor', 'Dust furniture', 'Clean windows',
                'Organize closet', 'Water plants'
            ];
            
            newChores.forEach(chore => {
                unassignedChores.push(`${chore} #${choreIdCounter++}`);
            });
            
            updateDisplay();
        }
        
        function randomAssignChores() {
            const activePlayers = getActivePlayers();
            
            if (activePlayers.length === 0) {
                alert('No active players to assign chores to!');
                return;
            }
            
            if (unassignedChores.length === 0) {
                alert('No unassigned chores to distribute!');
                return;
            }
            
            // Count current chores per player
            const counts = {};
            activePlayers.forEach(player => {
                counts[player.loc] = playerChores[player.loc].length;
            });
            
            // Shuffle unassigned chores for random distribution
            const shuffledChores = [...unassignedChores];
            for (let i = shuffledChores.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffledChores[i], shuffledChores[j]] = [shuffledChores[j], shuffledChores[i]];
            }
            
            // Assign each chore to player with fewest chores
            shuffledChores.forEach(chore => {
                // Find players with minimum chore count
                let minCount = Math.min(...Object.values(counts));
                const eligiblePlayers = activePlayers.filter(player => counts[player.loc] === minCount);
                
                // Randomly pick from eligible players
                const selectedPlayer = eligiblePlayers[Math.floor(Math.random() * eligiblePlayers.length)];
                
                // Assign chore
                playerChores[selectedPlayer.loc].push(chore);
                counts[selectedPlayer.loc]++;
            });
            
            // Clear unassigned chores
            unassignedChores = [];
            updateDisplay();
            
            // Show distribution summary
            const distribution = activePlayers.map(player => 
                `${player.name}: ${playerChores[player.loc].length} chores`
            ).join(', ');
            
            alert(`Assigned ${shuffledChores.length} chores!\nDistribution: ${distribution}`);
        }
        
        function clearAllChores() {
            Object.keys(playerChores).forEach(playerId => {
                unassignedChores.push(...playerChores[playerId]);
                playerChores[playerId] = [];
            });
            updateDisplay();
        }
        
        // Initialize display
        addTestChores();
        updateDisplay();
    </script>
</body>
</html>